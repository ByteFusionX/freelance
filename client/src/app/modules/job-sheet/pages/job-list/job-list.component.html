<div class="bg-white m-6 rounded-2xl">
    <div class="text-lg font-medium p-4 border-b border-b-gray-300 px-8">

        <div class="flex flex-col md:flex-row items-center justify-between md:items-end gap-3">
            <h3>Job Sheet</h3>

            <div class="flex justify-end gap-4">

                    <div class="w-48" (click)="handleNotClose($event)">
                       
                       
                        <div >
                            <ng-select [(ngModel)]="selectedStatus" class=" filter " placeholder="Status" appendTo="body" (change)="onfilterApplied()">
                                <ng-option *ngFor="let status of status"
                                    [value]="status.value">{{status.value}}</ng-option>
                            </ng-select>
                        </div>
                    </div>
                
               
            </div>

        </div>
    </div>

    <div class="m-8  overflow-y-auto">

        <table mat-table [dataSource]="dataSource" class="rounded-lg table-fixed">

            <!--- Note that these columns can be defined in any order.
                  The actual rendered columns are set as a property on the row definition" -->

            <!-- Position Column -->
            <ng-container matColumnDef="jobId">
                <th *matHeaderCellDef
                    class="bg-gray-100  px-[20px] py-[16px] text-start text-dark  text-[15px] font-medium border-none before:hidden">
                    Job ID </th>
                <td mat-cell *matCellDef="let element"> {{element.jobId}} </td>
            </ng-container>

            <!-- Name Column -->
            <ng-container matColumnDef="customerName">
                <th *matHeaderCellDef
                    class="bg-gray-100  px-[20px] py-[16px] text-start text-dark  text-[15px] font-medium border-none before:hidden">
                    Customer Name </th>
                <td mat-cell *matCellDef="let element"> {{element.clientDetails[0].companyName}} </td>
            </ng-container>

            <!-- Weight Column -->
            <ng-container matColumnDef="description">
                <th *matHeaderCellDef
                    class="bg-gray-100  px-[20px] py-[16px] text-start text-dark  text-[15px] font-medium border-none before:hidden">
                    Description </th>
                <td mat-cell *matCellDef="let element"> {{element.quotation[0].subject}} </td>
            </ng-container>

            <!-- Symbol Column -->
            <ng-container matColumnDef="salesPersonName">
                <th *matHeaderCellDef
                    class="bg-gray-100  px-[20px] py-[16px] text-start text-dark  text-[15px] font-medium border-none before:hidden">
                    Sales Person Name </th>
                <td mat-cell *matCellDef="let element"> {{element.salesPersonDetails[0].firstName+''+element.salesPersonDetails[0].lastName}} </td>
            </ng-container>

            <ng-container matColumnDef="department">
                <th *matHeaderCellDef
                    class="bg-gray-100  px-[20px] py-[16px] text-start text-dark  text-[15px] font-medium border-none before:hidden">
                    Department </th>
                <td mat-cell *matCellDef="let element"> {{element.departmentDetails[0].departmentName}} </td>
            </ng-container>

            <ng-container matColumnDef="lpo">
                <th *matHeaderCellDef
                    class="bg-gray-100  px-[20px] py-[16px] text-start text-dark  text-[15px] font-medium border-none before:hidden">
                    LPO </th>
                <td mat-cell *matCellDef="let element">
                    <div class="flex flex-col gap-2" *ngIf="element.files.length">
                        <div *ngFor="let file of element.files; let i=index">
                            <div class="flex" *ngIf="file.originalname">
                                <p class="w-24 truncate ..." matTooltip="{{file.originalname}}"
                                    matTooltipPosition="above" matTooltipClass="mat-tooltip">{{file.originalname}}
                                </p>
                                <button class="w-5 h-5 border rounded-full flex justify-center items-center"
                                    (click)="onDownloadClicks(file)">
                                    <ng-icon class="text-black" name="heroInboxArrowDown"></ng-icon>
                                </button>
                            </div>
                            <div class="w-24" *ngIf="file.filename && file.filename === selectedFile">
                                <mat-progress-bar mode="determinate" value="{{progress}}"></mat-progress-bar>
                            </div>
                        </div>
                    </div>    
                </td>
            </ng-container>

            <ng-container matColumnDef="quotations">
                <th *matHeaderCellDef
                    class="bg-gray-100  px-[20px] py-[16px] text-start text-dark  text-[15px] font-medium border-none before:hidden">
                    Quotations </th>
                <td mat-cell *matCellDef="let element"> {{element.quotation[0].quoteId}} </td>
            </ng-container>

            <ng-container matColumnDef="lpoValue">
                <th *matHeaderCellDef
                    class="bg-gray-100  px-[20px] py-[16px] text-start text-dark  text-[15px] font-medium border-none before:hidden">
                    LPO Value </th>
                <td mat-cell *matCellDef="let element"> {{element.lpoValue}} </td>
            </ng-container>

            <ng-container matColumnDef="status">
                <th *matHeaderCellDef
                class="bg-gray-100 text-center  px-[4px] py-[16px]  text-dark  text-[15px] font-medium border-none before:hidden">
                Status </th>
            <td mat-cell *matCellDef="let element;let i= index" class="">
                <div (click)="onStatus($event,element.status)" *ngIf="element.status !== 'Won' && element.status !== 'Lost'" class="flex items-center cursor-pointer border border-gray/60 rounded-[6px] px-[14px] py-1 max-w-fit hover:bg-white"
                    [matMenuTriggerFor]="beforeMenu" mat-button>
                    <p class="mx-2 text-sm whitespace-nowrap">{{element.status}}</p>
                    <div class="mt-1">
                        <ng-icon name="heroChevronDown"></ng-icon>
                    </div>
                </div>
                <mat-menu #beforeMenu="matMenu" class="mt-2 h-auto mat-elevation-z0 border">
                    <div class="" >
                        <div  *ngFor="let status of filteredStatuses(element.status)">
                        <p  class="p-2 hover:bg-violet-200 cursor-pointer   px-[12px]  text-dark  text-[15px] " *ngIf="status !== element.status" (click)="updateStatus(i,element._id,status)">
                            {{status}}</p>
                        </div>
                        
                    </div>
                </mat-menu>
                <div class="w-full flex justify-center items-center">
                    <p *ngIf="element.status === 'Won'"
                        class="w-fit text-center bg-green-100 rounded-full px-5 text-green-600  py-1">
                        {{element.status}}</p>
                    <p *ngIf="element.status === 'Lost'"
                        class="w-fit text-center bg-red-100 rounded-full px-5 text-red-600  py-1">
                        {{element.status}}</p>
                </div>
            </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>


    </div>
    <div>

    </div>
</div>